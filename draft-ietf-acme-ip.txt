



ACME Working Group                                          R. Shoemaker
Internet-Draft                                                      ISRG
Intended status: Standards Track                          March 08, 2017
Expires: September 9, 2017


                ACME IP Identifier Validation Extension
                       draft-ietf-acme-ip-latest

Abstract

   The Automatic Certificate Management Environment (ACME) protocol only
   defines identity validation challenges for DNS host names.  This
   document provides guidance on validation of IPv4 and IPv6 addresses
   which can then be included in X.509 certificates.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on September 9, 2017.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.




Shoemaker               Expires September 9, 2017               [Page 1]

Internet-Draft                   ACME-IP                      March 2017


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   2
   3.  IP Identifier . . . . . . . . . . . . . . . . . . . . . . . .   2
   4.  Identifier Validation Challenges  . . . . . . . . . . . . . .   2
     4.1.  Reverse DNS . . . . . . . . . . . . . . . . . . . . . . .   3
     4.2.  Existing Challenges . . . . . . . . . . . . . . . . . . .   4
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
     5.1.  Identifier Types  . . . . . . . . . . . . . . . . . . . .   5
     5.2.  Challenge Types . . . . . . . . . . . . . . . . . . . . .   5
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
     6.1.  Certificate Lifetime  . . . . . . . . . . . . . . . . . .   5
   7.  Normative References  . . . . . . . . . . . . . . . . . . . .   5
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .   5

1.  Introduction

   The identity validation challenges defined in ACME
   [I-D.ietf-acme-acme] only apply to validation of DNS host names.  In
   order to allow validation of IPv4 and IPv6 addresses for inclusion in
   X.509 certificates this document defines a new challenge and provides
   guidance on how already defined challenges can be used with these
   identifiers.

2.  Terminology

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
   and "OPTIONAL" are to be interpreted as described in BCP 14, RFC 2119
   [RFC2119] and indicate requirement levels for compliant ACME-Wildcard
   implementations.

3.  IP Identifier

   ACME [I-D.ietf-acme-acme] only defines the identifier type "dns"
   which is used to refer to fully qualified domain names.  If a ACME
   server wishes to request proof that a user controls a IPv4 or IPv6
   identifier it may create an authorization with the type "ip".  The
   value field of the identifier must contain the dot decimal notation
   format of the address as defined in RFC 3986 Section 3.2.2.

4.  Identifier Validation Challenges

   When creating an authorization for a IP identifier the following
   challenge types may be used to perform validation.





Shoemaker               Expires September 9, 2017               [Page 2]

Internet-Draft                   ACME-IP                      March 2017


4.1.  Reverse DNS

   With Reverse DNS validation the client proves control of an IP
   address by provisioning a TXT resource record containing a designated
   value for a specific validation domain name.

   type (required, string):  The string "reverse-dns-01"

   token (required, string):  A random value that uniquely identifies
      the challenge.  This value MUST have at least 128 bits of entropy,
      in order to prevent an attacker from guessing it.  It MUST NOT
      contain any characters outside the base64url alphabet, including
      padding characters ("=").

   GET /acme/authz/1234/2 HTTP/1.1
   Host: example.com

   HTTP/1.1 200 OK
   {
     "type": "reverse-dns-01",
     "url": "https://example.com/acme/authz/1234/2",
     "status": "pending",
     "token": "evaGxfADs6pSRb2LAv9IZf17Dt3juxGJ-PCt92wr-oA"
   }

   A client responds to this challenge by constructing a key
   authorization from the "token" value provided in the challenge and
   the client's account key.  The client then computes the SHA-256
   digest [FIPS180-4] of the key authorization.

   The record provisioned to the DNS is the base64url encoding of this
   digest.  The client constructs the validation domain name by
   prepending the label "_acme-challenge" to the domain name referenced
   in the PTR resource record for the IN-ADDR.ARPA [RFC1034] mapping of
   the IP address.  The client then provisions a TXT record with the
   digest for this name.  For example, if the IP address being validated
   is "192.0.2.1" and its IN-ADDR.ARPA mapping had the following PTR
   record:

   1.2.0.192.in-addr.arpa. 300 IN PTR example.com

   then the client would provision the following DNS record:

   _acme-challenge.example.com. 300 IN TXT "gfj9Xq...Rg85nM"

   The response to the Reverse DNS challenge provides the computed key
   authorization to acknowledge that the client is ready to fulfill this
   challenge.



Shoemaker               Expires September 9, 2017               [Page 3]

Internet-Draft                   ACME-IP                      March 2017


   keyAuthorization (required, string):  The key authorization for this
      challenge.  This value MUST match the token from the challenge and
      the client's account key.

   POST /acme/authz/1234/2
   Host: example.com
   Content-Type: application/jose+json

   {
     "protected": base64url({
       "alg": "ES256",
       "kid": "https://example.com/acme/acct/1",
       "nonce": "JHb54aT_KTXBWQOzGYkt9A",
       "url": "https://example.com/acme/authz/1234/2"
     }),
     "payload": base64url({
       "keyAuthorization": "evaGxfADs...62jcerQ"
     }),
     "signature": "Q1bURgJoEslbD1c5...3pYdSMLio57mQNN4"
   }

   On receiving a response, the server MUST verify that the key
   authorization in the response matches the "token" value in the
   challenge and the client's account key.  If they do not match, then
   the server MUST return an HTTP error in response to the POST request
   in which the client sent the challenge.

   To validate a DNS challenge, the server performs the following steps:

   1.  Compute the SHA-256 digest [FIPS180-4] of the key authorization

   2.  Query for PTR records for the IP identifiers IN-ADDR.ARPA mapping

   3.  Query for TXT records for the validation domain name

   4.  Verify that the contents of one of the TXT records matches the
       digest value

   If all of the above verifications succeed, then the validation is
   successful.  If no DNS records are found, or DNS records and response
   payload do not pass these checks, then the validation fails.

4.2.  Existing Challenges

   IP identifiers can be used with the existing HTTP and TLS-SNI
   challenges from RFC XXX Section XXX by skipping the DNS resolution
   step and using the relevant IP address as the HTTP or TLS server to
   directly connect to.



Shoemaker               Expires September 9, 2017               [Page 4]

Internet-Draft                   ACME-IP                      March 2017


5.  IANA Considerations

5.1.  Identifier Types

   Adds a new type to the Identifier list defined in Section XXX of RFC
   XXXX with the label 'ip' with the reference RFC XXXX.

5.2.  Challenge Types

   Adds a new type to the Challenge list defined in Section XXX of RFC
   XXXX with the label 'reverse-dns', identifier type 'ip', and
   reference RFC XXXX.

6.  Security Considerations

6.1.  Certificate Lifetime

   Given the often short assignment periods of IP addresses provided by
   various service providers CAs MAY want to impose much shorter
   lifetimes for certificates which contain IP identifiers.  They MAY
   also impose restrictions on IP identifiers which are in CIDRs which
   are assigned to service providers which are known to dynamically
   assign addresses from these CIDRs to users for indeterminate periods
   of time.

7.  Normative References

   [I-D.ietf-acme-acme]
              Barnes, R., Hoffman-Andrews, J., and J. Kasten, "Automatic
              Certificate Management Environment (ACME)", draft-ietf-
              acme-acme-05 (work in progress), February 2017.

   [RFC1034]  Mockapetris, P., "Domain names - concepts and facilities",
              STD 13, RFC 1034, DOI 10.17487/RFC1034, November 1987,
              <http://www.rfc-editor.org/info/rfc1034>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

Author's Address

   Roland Bracewell Shoemaker
   ISRG

   Email: roland@letsencrypt.org




Shoemaker               Expires September 9, 2017               [Page 5]
